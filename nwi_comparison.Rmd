---
title: "nwi_comparison"
author: "Inigo Peng"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
```
```{r}
nwi_comp <- read_csv("data/nwi_data/nwi_comparison.csv") |>
  mutate(across(-date, ~as.numeric(.x)),
         date = as.Date(date, format="%m/%d/%Y")) |> glimpse()
  
nwi_comp_long <- nwi_comp |>
  pivot_longer(!date, names_to = "index") |> 
  glimpse()
```
```{r}
nwi_wetness_index <- nwi_comp_long |> filter(index %in% c("wetness_index_v20_ip", "wetness_index_v20_vik"))

ggplot(nwi_wetness_index, aes(x = date, y = value, color = index)) +
    geom_line() +
    theme_minimal()

```
```{r}
wetness_index <- nwi_comp  |> 
  dplyr::select(c("date", "wetness_index_v20_ip", "wetness_index_v20_vik")) |> glimpse()

divergence_stats <- wetness_index  |> 
  mutate(index_diff = wetness_index_v20_ip - wetness_index_v20_vik) |>
  mutate(index_diff = as.numeric(index_diff)) |> 
  summarise(
    mean = mean(index_diff, na.rm=TRUE),        
    var_diff = var(index_diff,     na.rm = TRUE),        
    rmse = sqrt(mean(index_diff^2, na.rm = TRUE)),
    correlation = cor(
      wetness_index_v20_ip,
      wetness_index_v20_vik,
      use = "pairwise.complete.obs"
    )                                             
  )

print(divergence_stats)
```
generated wetness index is on average 0.00313 smaller than bureaus wetnessindex
generated wetness index and bureaus wetness index has 0.0002 in variability
root mean squared of 0.016 unit magnitude of difference
0.999 correlation between the two indices

```{r}
normalized_nwi_wetness_index <- nwi_comp_long |> filter(index %in% c("normalized_wetness_index_v20_ip", "normalized_wetness_index_v20_vik"))

ggplot(normalized_nwi_wetness_index, aes(x = date, y = value, color = index)) +
    geom_line() +
    theme_minimal()

```
```{r}
normalized_wetness_index <- nwi_comp  |> 
  dplyr::select(c("date", "normalized_wetness_index_v20_ip", "normalized_wetness_index_v20_vik")) |> glimpse()

divergence_normalzied_stats <- normalized_wetness_index  |> 
  mutate(index_diff = normalized_wetness_index_v20_ip - normalized_wetness_index_v20_vik) |>
  summarise(
    mean = mean(index_diff, na.rm=TRUE),        
    var_diff = var(index_diff,     na.rm = TRUE),        
    rmse = sqrt(mean(index_diff^2, na.rm = TRUE)),
    correlation = cor(
      normalized_wetness_index_v20_ip,
      normalized_wetness_index_v20_vik,
      use = "pairwise.complete.obs"
    )                                             
  )

print(divergence_normalzied_stats)
```
generated normalized wetness index is on average 0.0016 smaller than bureaus normalzied wetness index
generated normalized wetness index and bureaus normalized wetness index has 0.00006 in variability
root mean squared of 0.008 unit magnitude of difference
0.999 correlation between the two indices

```{r}
trailing_nwi_wetness_index <- nwi_comp_long |> filter(index %in% c("trailing_2_week_mean_nwi_v20_ip", "trailing_2_week_mean_nwi_v20_vik"))

ggplot(trailing_nwi_wetness_index, aes(x = date, y = value, color = index)) +
    geom_line() +
    theme_minimal()

```
```{r}
trailing_wetness_index <- nwi_comp  |> 
  dplyr::select(c("date", "trailing_2_week_mean_nwi_v20_ip", "trailing_2_week_mean_nwi_v20_vik")) |> glimpse()

divergence_trailing_stats <- trailing_wetness_index  |> 
  mutate(index_diff = trailing_2_week_mean_nwi_v20_ip - trailing_2_week_mean_nwi_v20_vik) |>
  summarise(
    mean = mean(index_diff, na.rm=TRUE),        
    var_diff = var(index_diff,     na.rm = TRUE),        
    rmse = sqrt(mean(index_diff^2, na.rm = TRUE)),
    correlation = cor(
      trailing_2_week_mean_nwi_v20_ip,
      trailing_2_week_mean_nwi_v20_vik,
      use = "pairwise.complete.obs"
    )                                             
  )

print(divergence_trailing_stats)
```
generated normalized wetness index is on average 0.0016 smaller than bureaus normalzied wetness index
generated normalized wetness index and bureaus normalized wetness index has 0.00005 in variability
root mean squared of 0.007 unit magnitude of difference
0.999 correlation between the two indices


## Early Prism Data vs Provisional Prism Data Comparison
```{r}
prism_data_comp <- read_csv("data/prism_data/early_provisional_comparison.csv") |> 
  mutate(across(-date, ~as.numeric(.x)),
         date = as.Date(date, format="%m/%d/%Y")) |> glimpse()
  
prism_comp_long <- prism_data_comp |>
  pivot_longer(!date, names_to = "index") |> 
  glimpse()
```
```{r}
normalized_30_trailing_sum <- prism_comp_long |> filter(index %in% c("early_normalized_30_trailing_sum_precipitation", "provisional_normalized_30_trailing_sum_precipitation"))

ggplot(normalized_30_trailing_sum, aes(x = date, y = value, color = index)) +
    geom_line() +
    theme_minimal()

```
```{r}
normalized_30_trailing_sum <- prism_data_comp  |> 
  dplyr::select(c("date", "early_normalized_30_trailing_sum_precipitation", "provisional_normalized_30_trailing_sum_precipitation")) |> glimpse()

divergence_normalzied_30_stats <- normalized_30_trailing_sum  |> 
  mutate(index_diff = early_normalized_30_trailing_sum_precipitation - provisional_normalized_30_trailing_sum_precipitation) |>
  summarise(
    mean = mean(index_diff, na.rm=TRUE),        
    var_diff = var(index_diff,     na.rm = TRUE),        
    rmse = sqrt(mean(index_diff^2, na.rm = TRUE)),
    correlation = cor(
      early_normalized_30_trailing_sum_precipitation,
      provisional_normalized_30_trailing_sum_precipitation,
      use = "pairwise.complete.obs"
    )                                             
  )

print(divergence_normalzied_30_stats)
```

```{r}
normalized_1095_trailing_sum <- prism_comp_long |> filter(index %in% c("early_normalized_trailing_sum_31_1095_d_precip_in", "provisional_normalized_trailing_sum_31_1095_d_precip_in"))

ggplot(normalized_1095_trailing_sum, aes(x = date, y = value, color = index)) +
    geom_line() +
    theme_minimal()

```
```{r}
normalized_1095_trailing_sum <- prism_data_comp  |> 
  dplyr::select(c("date", "early_normalized_trailing_sum_31_1095_d_precip_in", "provisional_normalized_trailing_sum_31_1095_d_precip_in")) |> glimpse()

divergence_normalzied_1095_stats <- normalized_1095_trailing_sum  |> 
  mutate(index_diff = early_normalized_trailing_sum_31_1095_d_precip_in - provisional_normalized_trailing_sum_31_1095_d_precip_in) |>
  summarise(
    mean = mean(index_diff, na.rm=TRUE),        
    var_diff = var(index_diff,     na.rm = TRUE),        
    rmse = sqrt(mean(index_diff^2, na.rm = TRUE)),
    correlation = cor(
      early_normalized_trailing_sum_31_1095_d_precip_in,
      provisional_normalized_trailing_sum_31_1095_d_precip_in,
      use = "pairwise.complete.obs"
    )                                             
  )

print(divergence_normalzied_1095_stats)
```

```{r}
nwi_wetness_index <- nwi_comp_long |> filter(index %in% c("normalized_30_d_trailing_sum_UKLNI", "Normalized 30-d trailing sum UKLNI"))

ggplot(nwi_wetness_index, aes(x = date, y = value, color = index)) +
    geom_line() +
    theme_minimal()

```
